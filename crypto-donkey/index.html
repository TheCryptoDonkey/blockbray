<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Opening Spotify… The Crypto Donkey</title>
  <meta name="robots" content="noindex,nofollow" />
  <meta property="og:title" content="The Crypto Donkey – Play on Spotify" />
  <meta property="og:description" content="Opening the track in Spotify…" />
  <meta property="og:type" content="website" />
  <link rel="preconnect" href="https://open.spotify.com" crossorigin>
  <link rel="dns-prefetch" href="//open.spotify.com">
  <style>
    :root { color-scheme: dark; }
    body{
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      display:flex; align-items:center; justify-content:center;
      min-height:100vh; margin:0; background:#0b0b0b; color:#fff;
    }
    .card{ text-align:center; max-width:520px; padding:28px; border-radius:16px; background:#121212; box-shadow:0 10px 30px rgba(0,0,0,.35); }
    .btn{ display:inline-block; padding:14px 18px; border-radius:999px; background:#1DB954; color:#000; font-weight:700; text-decoration:none; }
    .small{ opacity:.7; font-size:12px; margin-top:12px; }
  </style>

  <!-- Meta Pixel -->
  <script>
    !(function(f,b,e,v,n,t,s)
    {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
    n.callMethod.apply(n,arguments):n.queue.push(arguments)};
    if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
    n.queue=[];t=b.createElement(e);t.async=!0;
    t.src=v;s=b.getElementsByTagName(e)[0];
    s.parentNode.insertBefore(t,s)})(window,document,'script',
    'https://connect.facebook.net/en_US/fbevents.js');
    fbq('init', '3718618815109659');
    fbq('track', 'PageView');
  </script>
  <noscript><img height="1" width="1" style="display:none"
    src="https://www.facebook.com/tr?id=3718618815109659&ev=PageView&noscript=1"
  /></noscript>

  <script>
    // Build destination URLs
    const trackId = "7CXHAS76d157HvNmlbOdCW";
    const appUrl = `spotify://track/${trackId}`;
    const webBase = new URL(`https://open.spotify.com/track/${trackId}`);

    // Preserve incoming UTMs/fbclid/etc; add defaults if missing
    const incoming = new URLSearchParams(window.location.search);
    const defaults = new URLSearchParams({
      utm_source: 'meta',
      utm_medium: 'ad',
      utm_campaign: 'crypto_donkey_single'
    });
    for (const [k,v] of defaults) {
      if (!incoming.has(k)) incoming.set(k,v);
    }
    for (const [k,v] of incoming) webBase.searchParams.set(k,v);

    // Track an attempt and handle deep-link with graceful fallback
    let wentBackground = false;
    document.addEventListener('visibilitychange', () => {
      if (document.hidden) wentBackground = true; // likely switched to Spotify
    });

    function tryOpen() {
      fbq('trackCustom','AttemptDeepLink', { dest: 'spotify_app' });
      // Give the pixel a brief moment to flush before attempting the app open
      setTimeout(() => {
        // Attempt deep link
        try { window.location.href = appUrl; } catch(e) {}
        // If the app doesn't open (tab stays visible), go to web after ~1.2s
        setTimeout(() => {
          if (!wentBackground) {
            fbq('trackCustom','FallbackToWeb', { dest: 'spotify_web' });
            window.location.replace(webBase.toString());
          }
        }, 1200);
      }, 300);
    }

    window.addEventListener('load', tryOpen);
  </script>
</head>
<body>
  <div class="card">
    <h1>Opening in Spotify…</h1>
    <p>If nothing happens in a second, tap a button below.</p>
    <p>
      <a class="btn" href="spotify://track/7CXHAS76d157HvNmlbOdCW" rel="noreferrer noopener"
         onclick="fbq('trackCustom','FallbackClick',{dest:'app'})">Open in Spotify</a>
    </p>
    <p class="small">
      <a style="color:#8ab4ff" href="https://open.spotify.com/track/7CXHAS76d157HvNmlbOdCW" rel="noreferrer noopener"
         onclick="fbq('trackCustom','FallbackClick',{dest:'web'})">Open web player instead</a>
    </p>
  </div>
</body>
</html>
