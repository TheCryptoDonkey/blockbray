<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Echo Seven – Follow on Apple Music or Spotify</title>
  <meta property="og:title" content="Echo Seven – Artist Page" />
  <meta property="og:description" content="Follow Echo Seven on your favourite music service." />
  <meta property="og:type" content="website" />
  <meta name="twitter:card" content="summary" />
  <style>
    :root { color-scheme: dark; }
    body { font-family: system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif; background:#0b0b0b; color:#fff; display:flex; justify-content:center; align-items:center; min-height:100vh; margin:0; padding:24px; }
    .card { background:#121212; padding:28px; border-radius:16px; box-shadow:0 10px 30px rgba(0,0,0,.35); max-width:760px; text-align:center; display:flex; flex-direction:column; align-items:center; }
    h1 { font-size:28px; margin:0 0 10px; }
    p.lead { opacity:.9; margin:0 0 12px; }
    #teaserMount { order:2; width:100%; }
    audio { width:100%; max-width:660px; margin:8px 0; border-radius:12px; }
    .btns { display:flex; gap:18px; flex-wrap:wrap; justify-content:center; margin-top:8px; order:1; }
    .btn-wrap { display:flex; flex-direction:column; align-items:center; }
    .btn { padding:14px 18px; border-radius:999px; font-weight:700; text-decoration:none; border:0; cursor:pointer; }
    .btn-apple { background:#fff; color:#000; }
    .btn-spotify { background:#1DB954; color:#000; }
    .hint { font-size:12px; opacity:.75; margin-top:6px; }
    .small { font-size:12px; opacity:.7; margin-top:12px; }
    .sr-only { position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); border:0; }
      .row { display:flex; gap:10px; align-items:center; justify-content:center; }
    .pill { display:inline-flex; align-items:center; gap:6px; padding:8px 12px; border-radius:999px; background:#2a2a2a; color:#fff; font-size:13px; cursor:pointer; border:1px solid #3a3a3a; }
    .pill:hover { filter:brightness(1.08); }
  </style>
  <script>
    // --- Config ---
    const cfg = {
      utm: "utm_source=ad&utm_medium=landing&utm_campaign=echo_seven_follow",
      spotifyArtistId: "1xdDfEI9pjuEXglEaK8k4u",
      appleArtistFullUrl: "https://music.apple.com/gb/artist/echo-seven/1827674820",
      spotifyTrackId: "1Non9dMlsEcC5Mavv684al"
    };

    // --- Env detection ---
    const UA = navigator.userAgent || navigator.vendor || window.opera || "";
    const isIPadOSDesktop = /Macintosh/i.test(UA) && (("ontouchend" in document) || (navigator.maxTouchPoints>1));
    const isIOS = /iPad|iPhone|iPod/i.test(UA) || isIPadOSDesktop;
    const isAndroid = /Android/i.test(UA);
    const isDesktop = !isIOS && !isAndroid;

    function appendUtm(url){ return cfg.utm ? `${url}${url.includes('?') ? '&' : '?'}${cfg.utm}` : url; }

    // --- Follow handlers — deep link on iOS (on click), with clean fallbacks ---
    function pausePreview(){
      try { document.getElementById('preview')?.pause(); } catch(e) {}
    }

    function openSpotify(inNewTab=false){
      pausePreview();
      const appUri = `spotify://artist/${cfg.spotifyArtistId}`;
      const webUrl = appendUtm(`https://open.spotify.com/artist/${cfg.spotifyArtistId}`);
      if (isIOS){
        const t = Date.now();
        try { location.href = appUri; } catch(e) {}
        setTimeout(()=>{ if (Date.now()-t < 1500) location.replace(webUrl); }, 800);
        return;
      }
      if (isAndroid){
        const intent = `intent://artist/${cfg.spotifyArtistId}#Intent;scheme=spotify;package=com.spotify.music;S.browser_fallback_url=${encodeURIComponent(webUrl)};end`;
        location.href = intent;
        return;
      }
      // Desktop: optionally new tab
      if (inNewTab) window.open(webUrl, '_blank', 'noopener');
      else location.href = webUrl;
    }

    function openApple(){
      pausePreview();
      const url = appendUtm(cfg.appleArtistFullUrl);
      if (isIOS){
        // Universal link opens Apple Music app if installed; else web
        location.href = url;
        return;
      }
      if (isAndroid){
        const intent = `intent://${url.replace(/^https:\/\//,'')}#Intent;scheme=https;package=com.apple.android.music;S.browser_fallback_url=${encodeURIComponent(url)};end`;
        location.href = intent;
        return;
      }
      // Desktop
      location.href = url;
    }

    // --- HTML5 audio preview (preview.mp3). Fade in; if blocked, start on first gesture ---
    function fadeVolume(audio, to=1, ms=500){
      const start = audio.volume;
      const delta = to - start;
      if (Math.abs(delta) < 0.001) return;
      const t0 = performance.now();
      function step(t){
        const p = Math.min(1, (t - t0) / ms);
        audio.volume = Math.max(0, Math.min(1, start + delta * p));
        if (p < 1) requestAnimationFrame(step);
      }
      requestAnimationFrame(step);
    }

    function setupAudioPreview(){
      const audio = document.getElementById('preview');
      const state = document.getElementById('previewState');
      const unmuteBtn = document.getElementById('unmuteBtn');
      if (!audio) return;

      // Start muted for autoplay compliance; we'll unmute on first gesture or button click
      audio.muted = true;
      audio.volume = 1; // actual loudness will be controlled after unmute via fade

      const setState = (txt) => { if (state) state.textContent = txt; };

      audio.addEventListener('play', ()=> setState(audio.muted ? 'Preview is muted — turn sound on?' : 'Now playing preview…'));
      audio.addEventListener('pause', ()=> setState('Preview paused'));
      audio.addEventListener('ended', ()=> setState('Preview ended'));

      const unmute = () => {
        if (!audio.muted) return;
        audio.muted = false;
        // gentle fade from 0 to 1
        const startV = 0; audio.volume = startV;
        const to = 1; const ms = 500; const t0 = performance.now();
        function step(t){
          const p = Math.min(1, (t - t0) / ms);
          audio.volume = startV + (to-startV)*p;
          if (p < 1) requestAnimationFrame(step);
        }
        requestAnimationFrame(step);
        setState('Now playing preview…');
        if (unmuteBtn) unmuteBtn.classList.add('hide');
        cleanupGesture();
      };

      if (unmuteBtn) unmuteBtn.addEventListener('click', (e)=>{ e.preventDefault(); unmute(); });

      // Try immediate autoplay (muted)
      audio.play().catch(()=>{});

      // Unmute on first user gesture that's not a follow click
      const onGesture = (e) => {
        const id = (e.target && e.target.id) || '';
        if (id === 'btnApple' || id === 'btnSpotify') { cleanupGesture(); return; }
        unmute();
      };
      function cleanupGesture(){
        window.removeEventListener('pointerdown', onGesture, true);
        window.removeEventListener('touchstart', onGesture, true);
        window.removeEventListener('keydown', onGesture, true);
        window.removeEventListener('scroll', onGesture, true);
      }
      window.addEventListener('pointerdown', onGesture, true);
      window.addEventListener('touchstart', onGesture, true);
      window.addEventListener('keydown', (e)=>{
        if (e.code==='Space'||e.code==='Enter') onGesture(e);
      }, true);
      window.addEventListener('scroll', onGesture, true);

      // Pause preview when tab is hidden
      document.addEventListener('visibilitychange', ()=>{
        if (document.visibilityState === 'hidden') { try{ audio.pause(); }catch(_){} }
      });
    }

    document.addEventListener('DOMContentLoaded', ()=>{
      // Render lightweight HTML5 audio preview
      const mount = document.getElementById('teaserMount');
      if (mount){
        mount.innerHTML = `
          <iframe src="https://open.spotify.com/embed/track/${cfg.spotifyTrackId}" width="100%" height="80" frameborder="0"
            allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy" style="max-width:660px;border-radius:12px;"></iframe>`;
      }
      // Button actions
      document.getElementById('btnApple').addEventListener('click', openApple);
      document.getElementById('btnSpotify').addEventListener('click', ()=>openSpotify(isDesktop));

      // Button hints
      const appleHint = document.getElementById('appleHint');
      const spotifyHint = document.getElementById('spotifyHint');
      if (isIOS){
        appleHint.textContent = 'Opens Apple Music app';
        spotifyHint.textContent = 'Opens Spotify app';
      } else if (isAndroid){
        appleHint.textContent = 'Opens Apple Music app';
        spotifyHint.textContent = 'Opens Spotify app';
      } else {
        appleHint.textContent = 'Opens Apple Music website';
        spotifyHint.textContent = 'Opens Spotify in new tab';
      }
    });
  </script>
</head>
<body>
  <div class="card">
    <h1>Follow Echo Seven</h1>
    <p class="lead">Listen now and follow Echo Seven on your favourite music service.</p>

    <div id="teaserMount" aria-live="polite"></div>

    <div class="btns">
      <div class="btn-wrap">
        <button id="btnApple" class="btn btn-apple">Follow on Apple Music</button>
        <div id="appleHint" class="hint" aria-live="polite"></div>
      </div>
      <div class="btn-wrap">
        <button id="btnSpotify" class="btn btn-spotify">Follow on Spotify</button>
        <div id="spotifyHint" class="hint" aria-live="polite"></div>
      </div>
    </div>

    <p class="small">Direct links: <a href="https://music.apple.com/gb/artist/echo-seven/1827674820">Apple Music</a> · <a href="https://open.spotify.com/artist/1xdDfEI9pjuEXglEaK8k4u">Spotify</a></p>
  </div>
</body>
</html>
